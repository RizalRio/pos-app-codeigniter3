let url,produk=$("#produk").DataTable({responsive:!0,scrollX:!0,ajax:readUrl,columnDefs:[{searcable:!1,orderable:!1,targets:0}],order:[[2,"asc"]],columns:[{data:null},{data:"gambar"},{data:"barcode"},{data:"nama"},{data:"satuan"},{data:"kategori"},{data:"harga"},{data:"stok"},{data:"action"}]});function reloadTable(){produk.ajax.reload()}function addData(){$.ajax({url:addUrl,type:"post",dataType:"json",data:new FormData($("#form")[0]),processData:!1,contentType:!1,success(a){$(".modal").modal("hide"),Swal.fire("Sukses","Sukses Menambahkan Data","success"),reloadTable()},error(a){console.log(a)}})}function remove(a){Swal.fire({title:"Hapus",text:"Hapus data ini?",type:"warning",showCancelButton:!0}).then(()=>{$.ajax({url:deleteUrl,type:"post",dataType:"json",data:{id:a},success(){Swal.fire("Sukses","Sukses Menghapus Data","success"),reloadTable()},error(){console.log(a)}})})}function editData(){$.ajax({url:editUrl,type:"post",dataType:"json",data:new FormData($("#form")[0]),processData:!1,contentType:!1,success(){$(".modal").modal("hide"),Swal.fire("Sukses","Sukses Mengedit Data","success"),reloadTable()},error(a){console.log(a)}})}function add(){url="add",$(".modal-title").html("Add Data"),$('.modal button[type="submit"]').html("Add"),$.ajax({url:getBarcodeUrl,type:"post",dataType:"json",success(a){$('[name="barcode"]').val(a)}})}function edit(a){$.ajax({url:getProdukUrl,type:"post",dataType:"json",data:{id:a},success(a){$('[name="id"]').val(a.id),$('[name="barcode"]').val(a.barcode),$('[name="nama_produk"]').val(a.nama_produk),$('[name="satuan"]').append(`<option value='${a.satuan_id}'>${a.satuan}</option>`),$('[name="kategori"]').append(`<option value='${a.kategori_id}'>${a.kategori}</option>`),$('[name="harga"]').val(a.harga),$('[name="stok"]').val(a.stok),null!==a.gambar?$("#gambarReview").attr("src",siteUrl+"uploads/produk/"+a.gambar):$("#gambarReview").attr("src",siteUrl+"uploads/default.jpg"),$(".modal").modal("show"),$(".modal-title").html("Edit Data"),$('.modal button[type="submit"]').html("Edit"),url="edit"},error(a){console.log(a)}})}gambar.onchange=b=>{let[a]=gambar.files;a&&(gambarReview.src=URL.createObjectURL(a))},produk.on("order.dt search.dt",()=>{produk.column(0,{search:"applied",order:"applied"}).nodes().each((a,b)=>{a.innerHTML=b+1})}),$("#form").validate({errorElement:"span",errorPlacement(a,b){a.addClass("invalid-feedback"),b.closest(".form-group").append(a)},submitHandler(){"edit"==url?editData():addData()}}),$("#kategori").select2({placeholder:"Kategori",ajax:{url:kategoriSearchUrl,type:"post",dataType:"json",data:a=>({kategori:a.term}),processResults:a=>({results:a}),cache:!0}}),$("#satuan").select2({placeholder:"Satuan",ajax:{url:satuanSearchUrl,type:"post",dataType:"json",data:a=>({satuan:a.term}),processResults:a=>({results:a}),cache:!0}}),$(".modal").on("hidden.bs.modal",()=>{$("#form")[0].reset(),$("#form").validate().resetForm()})
